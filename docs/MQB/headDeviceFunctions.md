# Головное устройство
## Прошивка модуля MIB2 / MST2 Delphi/ (Активация голосового помошника, уселитель голоса, спорт монитор)

!!! warning "ВСЕ, ЧТО ВЫ БУДЕТЕ ДЕЛАТЬ, ЭТО ТОЛЬКО ВАША ОТВЕТСТВЕННОСТЬ...(ЕСЛИ НЕ УВЕРЕНЫ НЕ НАЧИНАЙТЕ)"

И так погнали... 
Что нам будет необходимо.
1. Вася или ODIS или другой шнурок для активации инженерного меню магнотолы (ЗЕЛЕНОЕ).
2. Odis для загрузки параметрии голосового уселителя.
3. USB-Ethernet адаптер:
Предпочтителен: d-link dub e 100 ревизий b1(серебристый), с1, d1
или https://aliexpress.ru/item/32969701309.html?spm=a2g0s.9042311.0.0.3b9d33edZKppDb&sku_id=12000018080745527 
работает без танцов с бубном, так сказать из посылки или другое стройство с чипом ASIX 88772. 
4. Для активации уселителя голоса нужна будет параметрия [(Параметрия под ODIS)](../firmwares/5F_ICC_ONLY.xml)....
5. Прошивка магнитолы.
6. SWAP магнитолы

1. Как распознать модуль Delphi?
Модули Delphi - это всегда стандартные устройства, а не устройства высокого уровня.
Соответственно, Delphi Unit всегда является Discover Media, а не Discover Pro.
Все модули Delphi являются устройствами Discover Media, но не все устройства Discover Media являются модулями Delphi!
Discover Media также может быть устройством Technisat Preh - просто для справки. 
Чтобы распознать устройство, не снимая его, необходимо удерживать кнопку «МЕНЮ» на радио в течение  длительного периода времени, пока не откроется другое меню. 

![Screenshot](../images/MQB/MIBII/1.png)

В этом меню вы выбираете пункт «Обновление / версии программного обеспечения», и теперь вы увидите версию программного обеспечения. 

![Screenshot](../images/MQB/MIBII/2.png)

```
(Delphi) SW Train Version ( MST2 _ ЕС _ VW _P 0891 D ) формируются следующим образом :

MST2 = MIB2 стандартного устройство
ЕС = Европейский вариант (аналог этого США)
VW = автомобиль
марка 0891 = Firmware 0891
D = Delphi Краткая версия модуля

: если в конце версии SW Train стоит буква D, значит, у вас есть модуль Delphi.
Если вы видите PQ или ZR после марки автомобиля или букву T в конце в версии SW Train, 
значит, у вас есть устройство Technisat Preh. 
```

### Только прошивка 0891 позволяет соединиться с MIBII по Ethernet-USB
(по моей информации)

Для прошивки магнитолы понадобится:

1. SD Card
2. Прошивка
```
Прошивки для Г.У., в частности Composition Media
mibsolution.eu
Логин: guest
Пароль: guest
MQB_Solution -> MST2-DELPHI -> Firmware -> VW -> EU -> MST2_EU_VW_P0891D_MU0891.7z
Спасибо Sash153 с Драйв2 за наводку
```
3. Активируйте инженерное меню.
 
 ```
Через VCDS
 Запустите VCDS и откройте блок управления 5F. 
 Откройте функцию 16 (авторизация доступа). 
 Введите код S12345 . 
 Откройте 10 (адаптация). 
 Выберите и активируйте режим разработчика. 
 ```

Обновление ПО MIBII
```
Отформатируйте SD-карту в FAT32.
Скопируйте файлы обновления прошивки на SD-карту 
(в корень.. должно быть 3 папки и текстовый файл после распоковки архива).
Вставьте SD-карту в слот для SD-карты 1.
Удалите все остальные SD-карты и USB-устройства!
Нажимайте на магнитоле кнопку MENU и дольше, пока не откроется другое (сервисное) меню. 
Выберите там тестовый режим.
```
![Screenshot](../images/MQB/MIBII/3.png)

```
Перейдите в категорию «SWDL».
```
![Screenshot](../images/MQB/MIBII/4.png)
```
Активируйте загрузку программного обеспечения Загрузка вручную и нажмите «Начать загрузку».
```
![Screenshot](../images/MQB/MIBII/5.png)
```
Выберите источник (SD-карта), выберите все и запустите обновление прошивки.
```
![Screenshot](../images/MQB/MIBII/6.png)

!!! warning ""
На что следует обратить внимание при обновлении прошивки?

    Оставьте зажигание включенным
    Отключите ненужных потребителей (свет, вентиляция, ...)
    Подключите зарядное устройство ( мощность зарядки не менее 15 А, лучше 20 А и больше)
    В зависимости от устройства (RAM / CPU) обновление занимает от 20 до 60 минут.
    

После обновления прошики на понели будет мигать глонас.. это нормально не бойтесь и может появится ошибка 
"Подверждения изменения по установке" т.е. нужно будет подтведить обновление прошивки кодом...

```
Это можно устранить с помощью VCDS. Для этого необходимо запустить VCDS и открыть блок 
управления информационной электроникой 5F в разделе выбора блока управления. 
10 (адаптация). 
Ищите подтверждение изменения установки. 
Там будет код его нужно ввнеси http://mib-helper.com/im-so-xory/ и получить 
ответный код и его вбить и подтвердить...

```

## Теперь самое главное и трудное....Если не готовы не продолжайте...

Чтобы установить соединение Telnet, необходимо активировать Ethernet
в зеленом меню.
Для этого зажмите кнопку МЕНЮ на магнитоле до тех пор, пока не появится 
(сервисное) меню. Затем перейдите в тестовый режим 
![Screenshot](../images/MQB/MIBII/7.png)
```
Теперь мы можем переключиться в Зеленое (Инженерное) меню 
(по желанию вы также можете попасть туда, нажав на кнопку МЕНЮ очень долго). 
```
![Screenshot](../images/MQB/MIBII/8.png)
```
Переключитесь в категорию «debuggung mlp». 
```
![Screenshot](../images/MQB/MIBII/9.png)

```
Активируйте Ethernet и перезапустите устройство 
(удерживайте кнопку питания не менее 10 секунд). 
```
![Screenshot](../images/MQB/MIBII/10.png)
```
После перезапуска агрегата необходимо активировать «Switch to MLP». 
```
![Screenshot](../images/MQB/MIBII/11.png)

Теперь адаптер USB-LAN можно подключить к USB-порту в автомобиле и подключить к ноутбуку с 
помощью кабеля LAN. Если светодиоды на адаптере загораются, подключение и настройка IPv4 
выполнены успешно (Настройки адаптера Ethernet IP - 192.168.1.10).

Запускаем программу Putty. IP-адрес MU берется из зеленого меню в качестве IP-адреса.
Случалось, что IP-адрес MU не отображался на некоторых устройствах, но он всегда использовался 192.168.1.4
в качестве порта, 23,  а затем нажимали «Открыть». 

Если все настроено правильно, вы можете сказать по логину QNX Neutrino, что он работает.
Для входа в Delphi Units требуется только слово «root». 

![Screenshot](../images/MQB/MIBII/12.jpg)

Как только появится приветствие, можно будет вводить команды. 

```
Команды:
cp= копировать
rm= удалить
chmod= изменить права (например, chmod 777= полные права чтения / записи)
mkdir= создать каталог (папку)
mount= монтировать путь
umount= размонтировать путь монтирования

Атрибуты:
-f= принудительно (перезапись / принудительно)
-R= рекурсивный (например, папка с содержимым и копировать / удалять подпапки)
-t= Запрос монтирования / особый тип (например, за которым следует qnx6)
-u= обновление (повторное монтирование)
-V= индикатор выполнения
-w= права чтения / записи (при монтировании) 
```

### Перед установкой патча важно сделать резервную копию! 
Для удобства 3 скрипта:
1. Бэкап.[(MST2_backup.sh)](../images/MQB/MIBII/MST2_backup.sh)
2. Патч SWAP [(MST2_patch.sh)](../images/MQB/MIBII/MST2_patch.sh)
3. Патч FEC кодов[(MST2_backup.sh)](../images/MQB/MIBII/MST2_fec.sh)
4. SWAP.
На флешку скиньте их просто в корень...


1. Делаем бекап MIBII. 

Вставьте (пустую) SD-карту в слот 1 и выполните следующие команды через Putty. 

Монтирумем SD карту...

cd / && mount -uw /sdc1/

далее запускаем скрипт.

cd / && /sdc1/MST2_backup.sh


```
Должны увидеть:
# MST2_backup.sh
ROOT access — OK
Making backup dir on SD Card — OK
mkdir: /sdc1/backup: File exists
SWaP *.fec files backup — OK
backup /ffs/etc/* — OK
cp: Can't create FIFO file (/sdc1/backup/script.fifo)
delphibin.ifs backup — OK
InstallationManager backup — OK
SWaP engine backup — OK
cp: Dest (/sdc1/mst2_patch.sh) must be a dir to copy dirs or multiple files to it.
profile backup — OK
MHConfig.cfg backup — OK
fs0 backup — OK
Saving unit info to file — OK
emmc serial numbler — SAVED
FINISHED — You can now remove SD Card
```

2. После выполнения бекапа, на флешке в папке pg есть файл *.fec он как раз нам и нужен...
с помощью [(M2DFGX16)](../images/MQB/MIBII/M2DFGX16.rar) MIB2 Delphi FEC Generator XTR3M3 
патчим наш fec, а именно отмечаем все пукнты которые вам нужны и сохраняем патченный fec файл.. 
только не затрите файл в бекапе...
```
помните: например.. если у вас с заводы активироване коды апп конект,  мирролинк и т.д.,
и когда вы будете патчить файл fec и их не отметите, то после заливки в магнитолу их у Вас не будет.
Если у Вас магнитола буз навигации то отмечайте все пункты, а навигацию нет...
```
3. Качаем SWAP [(SWAP)](../images/MQB/MIBII/MST2_EU_VW_P0891D.zip)
Берем SWAP для вашей магнитолы файл и патченный нами фалй fec кидаем в корень влешки...
и в PUTTY запускаем 

Монтирумем SD карту...

cd / && mount -uw /sdc1/

далее запускаем скрипт.

cd / && /sdc1/MST2_patch.sh


```
Должны увидеть:
# mst2_patch.sh
ROOT access — ok
SWaP patch — ok
cp: Copying /sdc1/SWaP to /home/mmc0t177_tmp/apps/bin/SWaP
100.00% (734/734 kbytes, 3883 kb/s)
FINISHED — You can now remove SD Card
```
Перезагружаем магнитолу долгим нажатием на кнопку включения.. ОБЯЗАТЕЛЬНО!!!!

4. PUTTY 

Монтирумем SD карту...

cd / && mount -uw /sdc1/

далее запускаем скрипт.

cd / && /sdc1/MST2_fec.sh

```
Должны увидеть:
# MST2_fec.sh
ROOT access — ok
*.FEC installation — ok
mkdir: /home/mmc0t180_tmp: File exists
FINISHED — You can now remove SD Card
```
Перезагружаем магнитолу долгим нажатием на кнопку включения.. ОБЯЗАТЕЛЬНО!!!!

Если по каким либо причинам не получилось, значит Вам не подошел SWAP файл, пробуйте другой SWAP...

Заливам параметрию для голосового уселителя через ODIS-E

    Выбираем нужный блок
    Пункт 010, подпункт 010.01 "Загрузка данных"
    Выбираем файл и начинаем загрузк

Перезагружаем магнитолу долгим нажатием на кнопку включения.. ОБЯЗАТЕЛЬНО!!!!

!!! warning ""
Может случиться так, что файлы FEC все еще находятся в буфере в устройстве и все еще доступны после перезагрузки.
Их, возможно, придется удалить несколько раз, пока они не станут недоступны в устройстве после перезагрузки.
rm -RVf /Persistence/SWaP/ppw/*
rm -RVf /Persistence/SWaP/illegal/*
После этого можно импортировать исправленный файл FEC.
cp -VRf /sdc1/*.fec /Persistence/SWaP/pg/
После ввода команд обязательна полная перезагрузка. 


Наслаждаемся результатом... Что сами за минимальную сумму сделали....

